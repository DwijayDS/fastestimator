pipeline{
    agent any
    stages {
        stage('Build-and-Test'){
            parallel{
                stage('CPU'){
                    agent {label 'jenkinsnightly_cpu'}
                    stages{
                        stage('Build-CPU'){
                            steps{
                                sh '''
                                echo "building CPU"
                                '''
                            }
                        }
                        stage('Test-CPU'){
                            steps{
                                sh '''
                                echo "testing CPU"
                                '''
                            }                           
                        }
                    }

                }

                stage('GPU'){
                    agent {label 'jenkinsnightly_gpu'}
                    stages{
                        stage('Build-GPU'){
                            steps{
                                sh '''
                                echo "building GPU"
                                '''
                            }
                        }
                        stage('Test-GPU'){
                            steps{
                                sh '''
                                echo "testing GPU"
                                exit 1
                                '''
                            }                           
                        }
                    }
                }
            }
        }

        stage('Deply-pypi'){
            steps{
                echo "Deploy-pypi"
            }
        }

        stage('Deploy-docker'){
            steps{
                echo "Deploy-docker"
            }
        }
    }
}